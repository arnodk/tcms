class Tcms {

    constructor() {
        this.token = '';
        this.base = '[baseurl]/index.php';
    }

    setFocus(sId) {
        document.getElementById(sId).focus();
    }

    apiEvent(sId, sEvent, sSystem, sAction, fEvent, fGenerateData, fResult) {
        let oId = document.getElementById(sId);
        let me = this;
        if (sEvent==='click') {
            oId.addEventListener('click',function(event) {
                if (typeof fEvent === 'function') fEvent();
                me.apiCall(sSystem,sAction,fGenerateData(),fResult);
            });
        }
    }

    goto(sSystem,sAction) {
        if (sSystem == "") return;
        let sUrl = this.base + '?system=' + sSystem;
        if (sAction!="") sUrl = sUrl + '&action=' + sAction;
        window.location.href = sUrl;
    }

    alert(sId,sText) {
        let oId = document.getElementById(sId)
        oId.classList.remove("d-none");
        oId.classList.add("alert");
        oId.classList.add("alert-danger");
        oId.innerHTML = 'Invalid session, login or password.';
    }

    clearAlert(sId) {
        let oId = document.getElementById(sId)
        oId.classList.add("d-none");
    }

    apiCall(sSystem, sAction, oData={}, fResult) {
        var sUrl = this.base + "?_apitoken=" + this.token + "&system=" + sSystem + "&action=" + sAction;
        this.postData(sUrl,oData).then(fResult);
    }

    setToken(sToken) {
        this.token = sToken;
    }

    postData(url = '', data = {}) {
        return fetch(url, {
            method: 'POST',
            mode: 'same-origin',
            cache: 'no-cache',
            credentials: 'same-origin',
            headers: {
                'Content-Type': 'application/json'
            },
            referrer: 'no-referrer',
            body: JSON.stringify(data)
        })
        .then(response => response.json());
    }

    addCard(sId,sTitle,sSubTitle,sDescription,sLinks) {
        let oId = document.getElementById(sId);
        let card = document.createElement('div');
        card.classList.add('card');
        card.innerHTML = '\
                <div class="card-body">\
                    <h5 class="card-title">'+sTitle+'</h5>\
                    <h6 class="card-subtitle mb-2 text-muted">'+sSubTitle+'</h6>\
                    <p class="card-text">'+sDescription+'</p>\
                    '+sLinks+'\
                </div>\
        ';
        oId.appendChild(card);
    }

    attachEditor(sId,sContent) {
        let oId = document.getElementById(sId);
        let sEditorId = sId + 'Editor';
        oId.innerHTML = '<textarea id="'+sEditorId+'" class="tcmsEditor form-control">'+sContent+'</textarea>';
    }

    addButton(sId,sButtonId,fOnClick,sCaption,sMode) {
        let oId = document.getElementById(sId);
        let button = document.createElement('a');
        button.classList.add('btn');
        button.classList.add('btn-'+sMode);
        button.innerHTML = sCaption;
        button.addEventListener('click',fOnClick);
        button.setAttribute("id",sButtonId);
        button.setAttribute("href","javascript://");
        oId.appendChild(button);
    }

    getEditor(sId) {
        return document.getElementById(sId + 'Editor');
    }

    escape(s) {
        s = s.replace("'","\\'");
        s = s.replace('"','\\"');
        return s;
    }
}

let tcms = new Tcms();